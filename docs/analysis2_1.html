<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Krukowski">

<title>Medienbasierte Wissenskonstruktion mit R - Apply &amp; Multiple data sources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Medienbasierte Wissenskonstruktion mit R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./assignments-overview.html" rel="" target="">
 <span class="menu-text">Übungsblätter</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./contact.html" rel="" target="">
 <span class="menu-text">Kontakt</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ntn.html" rel="" target="">
 <span class="menu-text">Nice to Know</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./analysis2_1.html">Anwendung: Fragebögen II</a></li><li class="breadcrumb-item"><a href="./analysis2_1.html">Apply &amp; Multiple data sources</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./assets/img/logo_ude.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download &amp; Installation von R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction &amp; Basics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Data Wrangling &amp; Visualisierung</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datawrangling_base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datawrangling_dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrangling mit dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataviz_ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualisierung mit ggplot2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Inferenzstatistik &amp; Berichten</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inferenzstatistik in R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto_reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Berichte in Quarto</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Anwendung: Fragebögen I</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Skalen mit across()</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wide/long Format</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inferenzstatistische Analyse</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Anwendung: Fragebögen II</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis2_1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Apply &amp; Multiple data sources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zusammenhängende Dataframes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5factorplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Umgang mit Faktoren in Plots</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Anwendung: Learning Analytics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learninganalytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysebeispiel - Virtual Learning Environment Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learninganalytics_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OULAD</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Datum &amp; Ausreißer</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis3_1_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dates &amp; Times</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5outlier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ausreißeranalyse</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#multiple-datenursprünge" id="toc-multiple-datenursprünge" class="nav-link active" data-scroll-target="#multiple-datenursprünge">Multiple Datenursprünge</a>
  <ul class="collapse">
  <li><a href="#working-memory-operation-span-ospan" id="toc-working-memory-operation-span-ospan" class="nav-link" data-scroll-target="#working-memory-operation-span-ospan">Working Memory Operation Span (OSPAN)</a></li>
  <li><a href="#mit-multiplen-daten-umgehen" id="toc-mit-multiplen-daten-umgehen" class="nav-link" data-scroll-target="#mit-multiplen-daten-umgehen">Mit multiplen Daten umgehen</a></li>
  <li><a href="#sind-loops-eine-gute-idee" id="toc-sind-loops-eine-gute-idee" class="nav-link" data-scroll-target="#sind-loops-eine-gute-idee">Sind Loops eine gute Idee?</a></li>
  </ul></li>
  <li><a href="#die-apply-familie" id="toc-die-apply-familie" class="nav-link" data-scroll-target="#die-apply-familie">Die <code>apply</code> Familie</a>
  <ul class="collapse">
  <li><a href="#listen-erstellen-mit-lapply" id="toc-listen-erstellen-mit-lapply" class="nav-link" data-scroll-target="#listen-erstellen-mit-lapply">Listen erstellen mit <code>lapply()</code></a>
  <ul class="collapse">
  <li><a href="#repetition-listen" id="toc-repetition-listen" class="nav-link" data-scroll-target="#repetition-listen">Repetition: Listen</a></li>
  </ul></li>
  <li><a href="#funktionen-und-lapply" id="toc-funktionen-und-lapply" class="nav-link" data-scroll-target="#funktionen-und-lapply">Funktionen und <code>lapply()</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Apply &amp; Multiple data sources</h1>
<p class="subtitle lead">Seminar[5] &lt;- Konkrete Anwendungsfälle: Limesurvey</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Simon Krukowski </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"dataset_srl_challenges_wrangled.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="multiple-datenursprünge" class="level1">
<h1>Multiple Datenursprünge</h1>
<p>Manchmal kommt es vor, dass wir nicht nur einen schönen, aufbereiteten Datensatz haben, sondern mehrere Dataframes, die wir irgendwie miteinander verknüpfen müssen. Oft geschehen Studien auch nicht nur in Limesurvey, sondern externe Tools bzw. Tests werden hinzugezogen, die dann wiederrum eigene Daten erzeugen. R bietet natürlich auch da vielfältige Möglichkeiten, damit umzugehen. Wir wollen das nun gemeinsam an einem Beispiel durchgehen</p>
<section id="working-memory-operation-span-ospan" class="level2">
<h2 class="anchored" data-anchor-id="working-memory-operation-span-ospan">Working Memory Operation Span (OSPAN)</h2>
<p>Mit dem OSPAN Test können wir die Arbeitsgedächtnisleistung von Proband:innen testen. Dazu gibt es ein <a href="https://github.com/mahiluthra/working_memory_tests">Tool</a> von Forscher:innen aus Indiana, welches über HTML &amp; Javascript läuft und womit wir die Arbeitsgedächtnisleistung testen können. Der Test sieht wie folgt aus:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/img/ospan.png" class="img-fluid figure-img" width="700"></p>
</figure>
</div>
<p>Er läuft im Browser, und nach Abschluss der Studie haben wir die Ergebnisse der einzelnen Proband:innen als einzelne <code>.csv</code> Dateien auf dem Server:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/img/ospan_tests.png" class="img-fluid figure-img" width="700"></p>
</figure>
</div>
<p>Kopiert also nun die aus Moodle heruntergeladenen 40 <code>.csv</code> Dateien in den Ordner <code>assets/datasets/ospan/</code>, wobei euer <code>dataset_srl_challenges_wrangled.csv</code> auf der obersten Ebene liegt (also auf der gleichen Ebene wie der Ordner <code>assets</code>).</p>
</section>
<section id="mit-multiplen-daten-umgehen" class="level2">
<h2 class="anchored" data-anchor-id="mit-multiplen-daten-umgehen">Mit multiplen Daten umgehen</h2>
<p>Wir beginnen also damit, uns einen Überblick über die einzelnen Dateien zu machen, welche sich unter <code>assets/datasets/ospan/</code> befinden. Natürlich müssen wir diese Dateien nicht einzeln als Liste übertragen, sondern können uns diese ganz einfach auflisten mit <code>list.files()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tests_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"assets/datasets/ospan/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir sehen nun, wenn wir uns das erzeugte Objekt <code>tests_list</code> anschauen, dass dieses unsere 40 Tests enthält:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tests_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "WM_operation_span_101_1612186377273.csv"
 [2] "WM_operation_span_106_1612359256107.csv"
 [3] "WM_operation_span_107_1612524224258.csv"
 [4] "WM_operation_span_15_1610368013780.csv" 
 [5] "WM_operation_span_20_1610447300494.csv" 
 [6] "WM_operation_span_23_1610461666072.csv" 
 [7] "WM_operation_span_24_1610465426790.csv" 
 [8] "WM_operation_span_27_1610465354156.csv" 
 [9] "WM_operation_span_31_1610465797553.csv" 
[10] "WM_operation_span_36_1610536583499.csv" 
[11] "WM_operation_span_39_1610544645563.csv" 
[12] "WM_operation_span_40_1610544829023.csv" 
[13] "WM_operation_span_43_1610551510486.csv" 
[14] "WM_operation_span_47_1610623434127.csv" 
[15] "WM_operation_span_48_1610623346034.csv" 
[16] "WM_operation_span_5_1610357167520.csv"  
[17] "WM_operation_span_51_1610623724516.csv" 
[18] "WM_operation_span_52_1610630827066.csv" 
[19] "WM_operation_span_54_1610637379465.csv" 
[20] "WM_operation_span_55_1610638115446.csv" 
[21] "WM_operation_span_6_1610357158395.csv"  
[22] "WM_operation_span_62_1610703127236.csv" 
[23] "WM_operation_span_64_1610713861384.csv" 
[24] "WM_operation_span_65_1610714043568.csv" 
[25] "WM_operation_span_66_1610714141398.csv" 
[26] "WM_operation_span_67_1610717257175.csv" 
[27] "WM_operation_span_68_1610716883738.csv" 
[28] "WM_operation_span_70_1610724891439.csv" 
[29] "WM_operation_span_71_1610962127977.csv" 
[30] "WM_operation_span_73_1610965288157.csv" 
[31] "WM_operation_span_76_1611048167607.csv" 
[32] "WM_operation_span_78_1611048577537.csv" 
[33] "WM_operation_span_79_1611055497570.csv" 
[34] "WM_operation_span_80_1611055678962.csv" 
[35] "WM_operation_span_84_1611134539309.csv" 
[36] "WM_operation_span_90_1611228773344.csv" 
[37] "WM_operation_span_91_1611228344338.csv" 
[38] "WM_operation_span_94_1611570780638.csv" 
[39] "WM_operation_span_96_1611581289527.csv" 
[40] "WM_operation_span_97_1611653179186.csv" </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Frage: Wie würden wir nun vorgehen? Wie können wir alle Dateien aus dieser Liste auf einmal importieren?</p>
</blockquote>
<p>Sicherlich kommen der einen oder dem anderen Informatiker:in nun <strong>Schleifen</strong> in den Sinn, die wir vielleicht aus anderen Programmiersprachen kennengelernt haben. Dazu gehören etwa <code>while</code> oder <code>for</code> . Solche Schleifen spielen im normalen R-Gebrauch nicht so eine große Rolle, daher werden wir hier nicht auf die genaue Syntax eingehen. Hier nur kurz, um es zu zeigen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (test <span class="cf">in</span> tests_list){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(test)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nun könnten wir natürlich auf die Idee kommen, über eine <code>for</code> Schleife alle Dateien aus der Liste einzulesen, und diese als einzelne Objekte in unserem Environment zu speichern:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (test <span class="cf">in</span> tests_list){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">"assets/datasets/ospan/"</span>,test))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Frage: Was passiert nun? Klappt der Code?</p>
</blockquote>
<p>Zwar sieht der obige Code aus, als würde er theoretisch klappen, allerdings tut er das nicht. Es werden nicht dynamisch neue Objekte im Environment erzeugt, sondern lediglich eines, welches <code>test</code> heißt und immer wieder überschrieben wird.</p>
</section>
<section id="sind-loops-eine-gute-idee" class="level2">
<h2 class="anchored" data-anchor-id="sind-loops-eine-gute-idee">Sind Loops eine gute Idee?</h2>
<p>Generell bietet es sich beim Programmieren natürlich immer an, Loops zu verwenden. Doch bei R sieht das etwas anders aus. Loops führen dort zu schlechter lesbaren Code, zu Variablen, die im globalen Environment gespeichert werden und so weiter. Doch wie lautet die Lösung? <code>apply</code>!</p>
</section>
</section>
<section id="die-apply-familie" class="level1">
<h1>Die <code>apply</code> Familie</h1>
<p>Mit <code>apply</code> können wir Operationen auf eine Vielzahl von Objekten, Zeilen oder Spalten anwenden. Es gibt verschiedene <code>apply</code> Funktionen, abhängig davon, was wir am Ende zurückbekommen wollen. So gibt es:</p>
<ul>
<li><p><code>apply</code>: Vektor/Liste/Array als Output</p></li>
<li><p><code>lapply</code>: Liste als Output</p></li>
<li><p><code>sapply</code>: Vektor/Matrix als Output</p></li>
<li><p>.. weitere (tapply, mapply etc.)</p></li>
</ul>
<p>Schauen wir uns also ein konkretes Beispiel an. Nehmen wir an, wir haben das dataframe <code>random_dataframe</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a random dataframe with 10 rows and 4 columns</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>random_dataframe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Score =</span> <span class="fu">runif</span>(<span class="dv">10</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>random_dataframe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["ID"],"name":[1],"type":["int"],"align":["right"]},{"label":["Age"],"name":[2],"type":["int"],"align":["right"]},{"label":["Score"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"48","3":"89.982497"},{"1":"2","2":"32","3":"24.608773"},{"1":"3","2":"31","3":"4.205953"},{"1":"4","2":"20","3":"32.792072"},{"1":"5","2":"59","3":"95.450365"},{"1":"6","2":"60","3":"88.953932"},{"1":"7","2":"54","3":"69.280341"},{"1":"8","2":"31","3":"64.050681"},{"1":"9","2":"42","3":"99.426978"},{"1":"10","2":"43","3":"65.570580"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Nun wollen wir <code>mean</code> für jede Spalte haben. Expert:innen würde hier bereits eine dplyr Lösung mit <code>summarise()</code> und <code>across()</code> einfallen. Aber wir versuchen es mit Base-R und <code>apply()</code>, um das Konzept zu veranschaulichen. Die Syntax wird am Beispiel am deutlichsten:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(random_dataframe, <span class="dv">2</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ID      Age    Score 
 5.50000 42.00000 63.43222 </code></pre>
</div>
</div>
<p>Zuerst wählen wir das dataframe <code>random_dataframe</code>, dann ob wir spalten- oder zeilenweise vorgehen wollen (<code>1</code> für zeilenweise, <code>2</code> für spaltenweise), und zuletzt übergeben wir die Funktion, die wir anwenden wollen. Super!</p>
<p>Kommen wir nun aber zurück zu unserem Working-Memory Datensatz und der Aufgabe, irgendwie die einzelnen Dateien zu importieren. Wie würden wir da vorgehen? Hier bietet sich <code>lapply</code> an, da es uns eine Liste gibt.</p>
<section id="listen-erstellen-mit-lapply" class="level2">
<h2 class="anchored" data-anchor-id="listen-erstellen-mit-lapply">Listen erstellen mit <code>lapply()</code></h2>
<p>Wenn wir also nicht so leicht einzelne Objekte im Environment erzeugen können oder wollen, bietet es sich an, diese in einer Liste zu speichern. Da kommt <code>lapply()</code> sehr gelegen. Wir übergeben der Funktion eine Liste oder einen Vektor, und bekommen eine Liste der gleichen Länge zurück.</p>
<section id="repetition-listen" class="level3">
<h3 class="anchored" data-anchor-id="repetition-listen">Repetition: Listen</h3>
<blockquote class="blockquote">
<p>Frage: Was waren nochmal Listen und wie unterscheiden sie sich von Vektoren?</p>
</blockquote>
<p>Genau, in Listen können wir mehr Datentypen, sowie auch verschiedene Datentypen unterbringen. Während folgender Code zwar funktioniert (aber alle übergebenen Elemente in <code>character</code> umwandelt):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Das"</span>,<span class="dv">1</span>,<span class="st">"geht so"</span>,<span class="fl">1.4</span>,<span class="st">"aber nicht."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Würde folgender Code die Elemente in ihrem usprünglichen Datencode belassen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sample_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>,<span class="st">"f"</span>,<span class="dv">12</span>,<span class="cn">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sample_list[<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] TRUE</code></pre>
</div>
</div>
<p>Das Resultat sind unterschiedliche Datentypen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"vec is "</span>, <span class="fu">typeof</span>(vec),<span class="st">" and sample_list is "</span>,<span class="fu">typeof</span>(sample_list)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "vec is character and sample_list is list"</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Was ist, wenn ich nun auf das <strong>zweite</strong> Objekt der Liste zugreifen will?</p>
</blockquote>
<p>Über <code>[]</code> bekommen wir das Objekt an der Stelle, aber als Liste. Das Objekt selbst bekommen wir über <code>[[]]</code>. <strong>Beachte: Bei R fangen wir nicht bei 0, sondern bei 1 an zu zählen!</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sample_list[[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
<p>Wie hilft uns das jetzt bei unserer Fragestellung? Schauen wir uns folgende zwei Beispiel-Dataframes erneut an:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>random_dataframe1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Score =</span> <span class="fu">runif</span>(<span class="dv">10</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>random_dataframe2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Score =</span> <span class="fu">runif</span>(<span class="dv">10</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(random_dataframe1,random_dataframe2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir können beide dataframes in einer Liste (<code>list_of_dfs</code>) zusammenfassen!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>list_of_dfs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
   ID Age    Score
1   1  52 75.84595
2   2  25 21.64079
3   3  43 31.81810
4   4  24 23.16258
5   5  59 14.28000
6   6  26 41.45463
7   7  36 41.37243
8   8  53 36.88455
9   9  31 15.24447
10 10  34 13.88061

[[2]]
   ID Age     Score
1   1  58 37.446278
2   2  27 66.511519
3   3  40  9.484066
4   4  44 38.396964
5   5  24 27.438364
6   6  44 81.464004
7   7  49 44.851634
8   8  55 81.006435
9   9  42 81.238951
10 10  51 79.434232</code></pre>
</div>
</div>
<p>Das heißt, wir könnten mit <code>lapply()</code> die Liste aus Variablennamen nutzen, um diese zu importieren. Dabei hilft uns <code>paste0</code>, um den Pfad entsprechend anzupassen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tests_list_with_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"assets/datasets/ospan/"</span>,tests_list)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tests_list_with_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "assets/datasets/ospan/WM_operation_span_101_1612186377273.csv"
[2] "assets/datasets/ospan/WM_operation_span_106_1612359256107.csv"
[3] "assets/datasets/ospan/WM_operation_span_107_1612524224258.csv"
[4] "assets/datasets/ospan/WM_operation_span_15_1610368013780.csv" 
[5] "assets/datasets/ospan/WM_operation_span_20_1610447300494.csv" 
[6] "assets/datasets/ospan/WM_operation_span_23_1610461666072.csv" </code></pre>
</div>
</div>
<p>Und nun könnten wir eine Liste mit den eingelesenen Dataframes erstellen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ospan_tests <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tests_list_with_path, read.csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wow! Das erspart uns eine Menge Arbeit.</p>
</section>
</section>
<section id="funktionen-und-lapply" class="level2">
<h2 class="anchored" data-anchor-id="funktionen-und-lapply">Funktionen und <code>lapply()</code></h2>
<p>Wir haben soeben mit lapply und der <code>read.csv()</code> Funktionen alle 40 Dataframes des OSPAN Tests eingelesen und in der Liste <code>ospan_tests</code> gespeichert.</p>
<blockquote class="blockquote">
<p>Was fällt bei einem Blick auf die einzelnen Dataframes auf?</p>
</blockquote>
<p>Ein Blick auf die 40 einzelnen Dataframes zeigt, dass diese <strong>immer gleich</strong> aufgebaut sind. Bei jedem Dataframe sind eventuell noch weitere Bearbeitungsschritte notwendig, und uns fehlt auch noch eine Zuordnung über die Proband:innen IDs. Das von uns verwendete <code>read.csv()</code> ist eine built-in Funktion. Hier bietet sich also eine Funktion an, bei der wir selbst entscheiden können, was mit den jeweiligen Dataframes passiert. Das geht natürlich auch mit R! Doch wie genau funktionieren überhaupt Funktionen in R?</p>
<p>Funktionen sind in R nach folgendem Prinzip aufgebaut:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>example_function <span class="ot">&lt;-</span> <span class="cf">function</span>(value){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">do_something</span>(value)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir definieren sie also normal wie auch Objekte in unserem Environment, definieren wie sie mit erhaltenen Objekten umgeht (<code>value</code>), und was sie damit machen soll (<code>do_something()</code>). Über <code>return(output)</code> können wir den <code>output</code> übergeben. Die Funktionsweise wird am besten mit Hilfe eines minimal-working examples deutlich:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>custom_function <span class="ot">&lt;-</span> <span class="cf">function</span>(object){</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> object<span class="sc">*</span><span class="dv">55</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">custom_function</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 550</code></pre>
</div>
</div>
<p>So weit so gut! Alles, was wir also in <code>function()</code> drinstehen haben, können wir also beliebig oft wiederholen.</p>
<p>Schauen wir uns also an, wie wir mit diesem neuen Wissen unser Problem weiter angehen können. Für eine komplette Lösung unseres Working-Memory Input Problems haben wir zwei (bzw. drei) Challenges:</p>
<ul>
<li><p>Daten importieren</p></li>
<li><p>Zuordnung zu Proband:innen erreichen</p></li>
<li><p>Datentransformationen (i.e., <code>wmc_PCU</code> erstellen)</p></li>
</ul>
<p>Eine Sache, die wir noch lernen müssen, hat mit der Zuordnung der Proband:innen und dem Dateinamen zu tun.</p>
<blockquote class="blockquote">
<p>Wo könnte sich dieser verstecken und was kann dabei helfen?</p>
</blockquote>
<p>Genau, unser WMC-Test Tool hat die Datei entsprechend mit dem Zuordnungscode abgespeichert, bspw. so: <code>WM_operation_span_101_1612186377273.csv</code>. Der Teil, der uns interessiert, ist <code>101</code>.</p>
<blockquote class="blockquote">
<p>Wie könnte man daran kommen?</p>
</blockquote>
<p>Dabei kann uns <code>str_split()</code> aus <code>stringr::</code> helfen (ist in <code>tidyverse</code>). Dessen Syntax sieht wie folgt aus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="fu">c</span>(<span class="st">"split_this_string"</span>,<span class="st">"split_this_string"</span>),<span class="st">"_"</span>)[[<span class="dv">1</span>]][<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wobei wir zuerst den String übergeben, und dann das Zeichen bzw. Muster, nach dem gesplittet werden soll. In unserem Fall ist es das <code>_</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="st">"WM_operation_span_101_1612186377273.csv"</span>,<span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "WM"                "operation"         "span"             
[4] "101"               "1612186377273.csv"</code></pre>
</div>
</div>
<p>Leider übergibt <code>str_split()</code> eine <strong>Liste von Vektoren</strong>. Das kann manchmal verwirren, ist aber nicht weiter schlimm. Ein Blick auf das Datenobjekt kann immer helfen:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/img/environment.png" class="img-fluid figure-img" width="500"></p>
</figure>
</div>
<p>Über <code>[[1]]</code> müssen wir also zunächst auf das <strong>erste Objekt</strong> der Liste zugreifen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(tests_list[<span class="dv">1</span>],<span class="st">"_"</span>)[[<span class="dv">1</span>]][<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "101"</code></pre>
</div>
</div>
<p>Dann können wir direkt danach das vierte Objekt des darin enthaltenen Vektors auswählen, also so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="st">"WM_operation_span_101_1612186377273.csv"</span>,<span class="st">"_"</span>)[[<span class="dv">1</span>]][<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "101"</code></pre>
</div>
</div>
<p>Nun haben wir den Zuordnungscode! Wir können nun alles vorbereiten, um unseren <code>wmc_PCU</code> Wert aus dem Dataframe zu extrahieren. Fangen wir also zunächst mit einem einzelnen Dataframe an, und überführen das dann später in eine Funktion und wenden das mit <code>lapply()</code> auf alles an (so eine Vorgehensweise ist immer ratsam).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>sample_filename <span class="ot">&lt;-</span> tests_list[<span class="dv">1</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>subject_id <span class="ot">&lt;-</span> <span class="fu">str_split</span>(sample_filename,<span class="st">"_"</span>)[[<span class="dv">1</span>]][<span class="dv">4</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>filename_with_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"assets/datasets/ospan/"</span>,sample_filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(filename_with_path)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(set_size)) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(accuracy)) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">accuracy =</span> <span class="fu">as.numeric</span>(accuracy)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">17</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">wmc_PCU =</span> accuracy<span class="sc">/</span>set_size) <span class="sc">%&gt;%</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">wmc_PCU =</span> <span class="fu">mean</span>(wmc_PCU))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(subject_id,df)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["subject_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["wmc_PCU"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"101","2":"0.9880952"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Perfekt! Wir haben nun ein Dataframe, das den <code>wmc_PCU</code> Mittelwert, sowie die dazugehörige <code>subject_id</code> enthält. Jetzt müssen wir nur noch den entsprechenden Code in eine Funktion packen, und schön können wir es mit <code>lapply()</code> auf unsere gesamte Liste anwenden:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>readAndWrangleWMCs <span class="ot">&lt;-</span> <span class="cf">function</span>(object){</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> object</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  subject_id <span class="ot">&lt;-</span> <span class="fu">str_split</span>(filename,<span class="st">"_"</span>)[[<span class="dv">1</span>]][<span class="dv">4</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  filename_with_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"assets/datasets/ospan/"</span>,filename)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(filename_with_path)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(set_size)) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(accuracy)) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">accuracy =</span> <span class="fu">as.numeric</span>(accuracy)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">17</span>)<span class="sc">%&gt;%</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">wmc_PCU =</span> accuracy<span class="sc">/</span>set_size) <span class="sc">%&gt;%</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">wmc_PCU =</span> <span class="fu">mean</span>(wmc_PCU))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(subject_id,df)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Machen wir nun einen kleinen Test mit dem ersten Objekt aus <code>tests_list</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readAndWrangleWMCs</span>(tests_list[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["subject_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["wmc_PCU"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"101","2":"0.9880952"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Perfekt, das scheint zu funktionieren! Nun können wir also die Funktion auf den ganzen Vektor aus Dateinamen <code>tests_list</code> anwenden mit <code>lapply()</code>. Zurück bekommen wir dann eine Liste:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dfs_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tests_list,readAndWrangleWMCs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nun haben wir noch das Problem, dass wir eine Liste mit 40 Dataframes haben, obwohl wir am liebsten ein großes Dateframe mit den entsprechenden Werten hätten. Dabei kann uns <code>dplyr</code>’s <code>bind_rows()</code> helfen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(dfs_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["subject_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["wmc_PCU"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"101","2":"0.9880952"},{"1":"106","2":"1.0000000"},{"1":"107","2":"0.9404762"},{"1":"15","2":"1.0000000"},{"1":"20","2":"0.7488095"},{"1":"23","2":"0.8329365"},{"1":"24","2":"0.7063492"},{"1":"27","2":"0.5817460"},{"1":"31","2":"0.7908730"},{"1":"36","2":"0.6904762"},{"1":"39","2":"0.6619048"},{"1":"40","2":"0.8928571"},{"1":"43","2":"0.7176587"},{"1":"47","2":"0.9444444"},{"1":"48","2":"0.9047619"},{"1":"5","2":"0.7271825"},{"1":"51","2":"0.7551587"},{"1":"52","2":"0.6654762"},{"1":"54","2":"0.7936508"},{"1":"55","2":"0.8910714"},{"1":"6","2":"0.5436508"},{"1":"62","2":"0.7698413"},{"1":"64","2":"0.8702381"},{"1":"65","2":"0.3904762"},{"1":"66","2":"0.8869048"},{"1":"67","2":"0.9285714"},{"1":"68","2":"0.5992063"},{"1":"70","2":"0.9404762"},{"1":"71","2":"0.8263889"},{"1":"73","2":"0.5916667"},{"1":"76","2":"0.6099206"},{"1":"78","2":"0.8789683"},{"1":"79","2":"0.8126984"},{"1":"80","2":"0.9333333"},{"1":"84","2":"0.7738095"},{"1":"90","2":"0.7075397"},{"1":"91","2":"0.9285714"},{"1":"94","2":"0.6892857"},{"1":"96","2":"1.0000000"},{"1":"97","2":"0.6503968"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Nun noch einem Objekt zuweisen, und wir sind bereit, es mit unserem vorhandenen Datensatz zu verbinden!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>WMC_vals <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dfs_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wie das geht, erfahrt ihr nun.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>